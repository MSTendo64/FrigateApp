<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FrigateApp.ViewModels"
             xmlns:controls="using:FrigateApp.Controls"
             x:Class="FrigateApp.Views.CameraPlayerView"
             x:DataType="vm:CameraPlayerViewModel"
             x:CompileBindings="True">


    <Grid RowDefinitions="Auto,*">
        <Border Grid.Row="0" Background="#1a1a1a" Padding="12,8" BorderBrush="#333" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*">
                <Button Content="← Назад" Command="{Binding BackCommand}" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <TextBlock Text="{Binding CameraName}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusText}" Foreground="#888" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ErrorText}" Foreground="Orange" IsVisible="{Binding HasError}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- MJPEG: контент в панели размером "render" (как у RTSP), зум/пан от (0,0). -->
        <Border x:Name="MjpegContainer" Grid.Row="1" Background="Black" ClipToBounds="True"
                IsVisible="{Binding ShowMjpeg}">
            <Canvas x:Name="MjpegCanvas">
                <Panel x:Name="MjpegContentPanel" RenderTransformOrigin="0,0">
                    <Panel.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform ScaleX="{Binding ZoomLevel}" ScaleY="{Binding ZoomLevel}"/>
                            <TranslateTransform X="{Binding PanX}" Y="{Binding PanY}"/>
                        </TransformGroup>
                    </Panel.RenderTransform>
                    <Image Source="{Binding MjpegFrame}" Stretch="Fill"/>
                </Panel>
            </Canvas>
        </Border>

        <!-- RTSP плеер (LibVLC) — не на Linux -->
        <controls:CameraPlayer x:Name="Player" Grid.Row="1"
                               IsVisible="{Binding ShowLibVlcPlayer}"/>

        <!-- RTSP плеер (RtspClientSharp) — только на Linux -->
        <controls:RtspSharpPlayer x:Name="RtspSharpPlayer" Grid.Row="1"
                                 IsVisible="{Binding ShowRtspSharpPlayer}"/>
        
        <!-- Индикатор загрузки -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                    IsVisible="{Binding IsLoading}" Spacing="12">
            <ProgressBar IsIndeterminate="True" Width="200"/>
            <TextBlock Text="{Binding StatusText}" Foreground="White" HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
</UserControl>
