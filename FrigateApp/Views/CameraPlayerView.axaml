<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FrigateApp.ViewModels"
             xmlns:controls="using:FrigateApp.Controls"
             xmlns:conv="using:Avalonia.Data.Converters"
             x:Class="FrigateApp.Views.CameraPlayerView"
             x:DataType="vm:CameraPlayerViewModel"
             x:CompileBindings="True">


    <Grid RowDefinitions="Auto,*">
        <Border Grid.Row="0" Background="#1a1a1a" Padding="12,8" BorderBrush="#333" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*">
                <Button Content="← Назад" Command="{Binding BackCommand}" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding StatusText}" Foreground="#888" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ErrorText}" Foreground="Orange" IsVisible="{Binding HasError}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Нативный плеер LibVLC, воспроизводящий локальный fMP4-файл из WebSocket потока -->
        <controls:CameraPlayer x:Name="Player" Grid.Row="1"/>

        <!-- Снапшот пока нет видео -->
        <Image Source="{Binding Snapshot}"
               Stretch="Uniform"
               IsVisible="{Binding VideoFilePath, Converter={x:Static conv:StringConverters.IsNullOrEmpty}}"/>

        <!-- Индикатор загрузки -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                    IsVisible="{Binding IsLoading}" Spacing="12">
            <ProgressBar IsIndeterminate="True" Width="200"/>
            <TextBlock Text="{Binding StatusText}" Foreground="White" HorizontalAlignment="Center"/>
        </StackPanel>
        
        <!-- Индикатор: поток есть, но изображения нет -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                    IsVisible="{Binding HasError}" Spacing="12">
            <TextBlock Text="⚠️" FontSize="48" HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding ErrorText}" Foreground="Orange" HorizontalAlignment="Center" 
                       TextWrapping="Wrap" MaxWidth="400"/>
            <TextBlock Text="{Binding StatusText}" Foreground="#888" HorizontalAlignment="Center" 
                       FontSize="12"/>
        </StackPanel>
    </Grid>
</UserControl>
