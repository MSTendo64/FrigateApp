<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FrigateApp.ViewModels"
             xmlns:conv="using:Avalonia.Data.Converters"
             xmlns:localconv="using:FrigateApp.Converters"
             xmlns:controls="using:FrigateApp.Controls"
             x:Class="FrigateApp.Views.EventsView"
             x:DataType="vm:EventsViewModel">

    <Grid RowDefinitions="Auto,Auto,*">
        <Border Grid.Row="0" Background="#1a1a1a" Padding="12,8" BorderBrush="#333" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*">
                <Button Content="← Назад" Command="{Binding BackCommand}" VerticalAlignment="Center" Margin="0,0,12,0"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <TextBlock Text="Обзор событий" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding CameraNames}"
                              SelectedItem="{Binding SelectedCamera}"
                              MinWidth="120"
                              VerticalAlignment="Center"/>
                    <TextBox Text="{Binding SelectedLabel}" Watermark="Метка (all)" Width="80" VerticalAlignment="Center"/>
                    <TextBox Text="{Binding LimitText}" Width="50" VerticalAlignment="Center" Watermark="100"/>
                    <Button Content="Обновить" Command="{Binding LoadEventsCommand}" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ErrorText}" Foreground="Orange" IsVisible="{Binding ErrorText, Converter={x:Static conv:StringConverters.IsNotNullOrEmpty}}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="1" Background="#252525" Padding="12,6" BorderBrush="#333" BorderThickness="0,0,0,1">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <controls:TimelineControl x:Name="Timeline"
                                           MinWidth="{Binding TimelineWidth}"
                                           RangeStart="{Binding TimelineRangeStart}"
                                           RangeEnd="{Binding TimelineRangeEnd}"
                                           Segments="{Binding TimelineSegments}"/>
            </ScrollViewer>
        </Border>

        <Grid Grid.Row="2">
            <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsLoading}" Height="4" VerticalAlignment="Top"/>
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ListBox ItemsSource="{Binding Events}"
                         SelectedItem="{Binding SelectedEventItem}"
                         Margin="12"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="vm:EventItemViewModel">
                            <Button Command="{Binding OpenCommand}"
                                    Background="#222" BorderBrush="#444" BorderThickness="1"
                                    Padding="0" Margin="4" Cursor="Hand"
                                    Width="200" Height="180">
                                <Grid RowDefinitions="Auto,*">
                                    <Image Grid.Row="0" Source="{Binding Thumbnail, Converter={x:Static localconv:NullToPlaceholderBitmapConverter.Instance}}"
                                           Stretch="UniformToFill" Height="120"/>
                                    <StackPanel Grid.Row="1" Margin="6,4">
                                        <TextBlock Text="{Binding Label}" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Text="{Binding Camera}" FontSize="10" Foreground="#888"/>
                                        <TextBlock Text="{Binding StartTimeText}" FontSize="10" Foreground="#888"/>
                                        <TextBlock Text="{Binding DurationText}" FontSize="10" Foreground="#aaa"/>
                                    </StackPanel>
                                </Grid>
                            </Button>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
